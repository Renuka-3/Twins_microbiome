---
title: "alpha"
author: "Renuka"
date: "2023-12-30"
output: html_document
---

```{r setup, message=TRUE, include=FALSE}
library("mia")
tse <- readRDS("data/twins_tse.rds")
#Alpha diversity measures
tse <- mia::estimateDiversity(tse, 
                              assay_name = "counts",
                              index = "shannon", 
                              name = "shannon")
head(colData(tse)$shannon)

library(ggplot2)
library(patchwork)
library(ggsignif)
library(ggpubr)

df <- as.data.frame(colData(tse))
a <- ggplot(df, aes(x = Diet, y = shannon)) +    ## Shannon Diversity for Diet
geom_boxplot(outlier.shape = NA) + 
  geom_jitter(width = 0.05) + 
  labs(y= "Shannon index", x= "", title = "A. Diet") + theme_bw() + theme(text = element_text(size = 13), axis.text = element_text(size = 10), axis.title = element_text(size = 12)) + geom_bracket(xmin = "Mixed", xmax= "Vegetarian", y.position = 2.2,label = "0.40") #+ geom_signif(comparisons = list(c("Mixed", "Vegetarian")), map_signif_level = FALSE, na.rm = TRUE)
  
b <- ggplot(df, aes(x = Gender, y = shannon)) +    ## Shannon Diversity for Gender
geom_boxplot(outlier.shape = NA) + 
  geom_jitter(width = 0.05) + 
  labs(y= "Shannon index", x= "", title = "B. Gender") + theme_bw() + theme(text = element_text(size = 13), axis.text = element_text(size = 10), axis.title = element_text(size = 12)) + geom_bracket(xmin = "Female", xmax= "Male", y.position = 2.2,label = "0.95") #+ geom_signif(comparisons = list(c("Male", "Female")), map_signif_level = FALSE, na.rm = TRUE)

c <- ggplot(df, aes(x = Geographical_location, y = shannon)) +    ## Shannon Diversity for location
geom_boxplot(outlier.shape = NA) + 
  geom_jitter(width = 0.05) + 
  labs(y= "Shannon index", x= "", title = "C. Geographical location") + theme_bw() + theme(text = element_text(size = 13), axis.text = element_text(size = 10), axis.title = element_text(size = 12)) + geom_signif(comparisons = list(c("Ahmednagar", "Pune"), c("Pune","Nashik"), c("Nashik", "Ahmednagar")), map_signif_level = FALSE, na.rm = TRUE)

## Multiple pairwise comparison for all co-factors
m <- c()
l <- df
m[["Diet"]] <- kruskal.test(data = l, shannon ~ factor(Diet))$p.value
m[["Geographical_location"]] <- kruskal.test(data = l, shannon ~ factor(Geographical_location))$p.value
m[["Gender"]] <- kruskal.test(data = l, shannon ~ factor(Gender))$p.value
p.adjust(m, method="fdr")

library(grid)
library(gridExtra)
gridExtra::grid.arrange(a, b, c, ncol = 3)

d <- ggplot(df, aes(x = Pair, y = shannon)) +    ## Shannon Diversity for twin pair (between)
geom_boxplot(outlier.shape = NA) + 
  geom_jitter(width = 0.05) + 
  labs(y= "Shannon index", x= "", title = "Twin-pair diversity") + theme_bw() + theme(text = element_text(size = 13), axis.text = element_text(size = 10), axis.title = element_text(size = 12)) + geom_signif(comparisons = list(c("Twin1", "Twin2"), c("Twin1", "Twin9"), c("Twin3", "Twin4")), map_signif_level = FALSE, na.rm = TRUE)

print(d)

## anosim
df <- as.data.frame(colData(tse))
library(vegan)
df <- as.data.frame(colData(tse))
s <- anosim(df$shannon, df$Pair, permutations = 999)
summary(s)
plot(s)

df <- as.data.frame(colData(tse))

library(vegan)
df <- as.data.frame(colData(tse))
s <- anosim(df$shannon, df$Samples, permutations = 999)
summary(s)
plot(s)
```

