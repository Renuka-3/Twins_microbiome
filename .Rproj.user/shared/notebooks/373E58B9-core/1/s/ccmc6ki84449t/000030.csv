"0","library(mia)"
"0","library(miaViz)"
"0","library(dplyr)"
"0","tse <- readRDS(""data/twins_tse.rds"")"
"0","tse <- relAbundanceCounts(tse)"
"0","tse_Genus <- agglomerateByRank(tse, rank =""Genus"", onRankOnly=TRUE)"
"0","top_taxa <- getTopTaxa(tse_Genus,top =6, detection = 0.1/100, prevalence = 1/100, method = ""prevalence"", assay_name = ""relabundance"")"
"0","Genus_renamed <- lapply(rowData(tse)$Genus,"
"0","                   function(x){if (x %in% top_taxa) {x} else {""Other""}})"
"0","rowData(tse)$Genus <- as.character(Genus_renamed)"
"0",""
"0","merged <- mergeCols(tse, colData(tse)$Samples)"
"0","merged1 <- transformCounts(merged, abund_values = ""counts"","
"0","                              method = ""relabundance"")"
"0",""
"0","a <- plotAbundance(merged, assay_name=""relabundance"", rank = ""Genus"","
"0","              #order_rank_by=""abund"", "
"0","              order_sample_by = ""Staphylococcus"", add_x_text = TRUE)+ labs(x = ""Samples"", y = ""Relative abundance (%)"", title = ""Core genus"")"
"0","print(a)"
